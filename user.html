<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>LibraTech - ƒê·ªôc gi·∫£</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="data.js"></script>
    <style>
        @import url("https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@600;800&display=swap");

        body {
            font-family: "Plus Jakarta Sans", sans-serif;
            background: #f8fafc;
        }

        /* Sidebar m√†u nh·∫°t h∆°n (Peach/Pastel Orange) */
        .sidebar-vibrant {
            background: linear-gradient(180deg, #ffb347 0%, #ffcc33 100%);
            box-shadow: 10px 0 30px rgba(255, 179, 71, 0.15);
        }

        /* ·∫®n thanh scroll cho Chrome, Safari v√† Firefox */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }

        .no-scrollbar {
            -ms-overflow-style: none;
            /* IE and Edge */
            scrollbar-width: none;
            /* Firefox */
        }

        /* M·ª•c menu m·∫∑c ƒë·ªãnh: Trong su·ªët ho√†n to√†n */
        .nav-item {
            margin-bottom: 0.5rem;
            padding: 1rem 1.5rem;
            border-radius: 1.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            color: rgba(255, 255, 255, 0.9);
            font-weight: 700;
            transition: all 0.3s ease;
            cursor: pointer;
            background: transparent;
            /* M·∫∑c ƒë·ªãnh kh√¥ng c√≥ n·ªÅn */
        }

        /* Hover: Ch·ªâ thay ƒë·ªïi m√†u ch·ªØ v√† ƒë·ªô s√°ng, kh√¥ng hi·ªán n·ªÅn tr·∫Øng */
        .nav-item:hover {
            color: #ffffff;
            padding-left: 1.8rem;
            background: rgba(255, 255, 255, 0.1);
            /* N·ªÅn m·ªù c·ª±c nh·∫π khi hover */
        }

        /* Active: Ch·ªâ m·ª•c n√†y m·ªõi c√≥ n·ªÅn tr·∫Øng */
        .nav-item.active {
            background: #ffffff !important;
            color: #ff8c00 !important;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.05);
            transform: scale(1.02);
        }

        .nav-item span {
            font-size: 1.25rem;
        }

        /* N·ªÅn v√πng Main: Gradient t·ª´ tr·∫Øng sang cam c·ª±c nh·∫°t ho·∫∑c xanh nh·∫°t */
        .main-vibrant-bg {
            background: linear-gradient(145deg,
                    #f8fafc 0%,
                    #fff5e6 50%,
                    #f0f9ff 100%);
            background-attachment: fixed;
            /* Gi·ªØ n·ªÅn c·ªë ƒë·ªãnh khi cu·ªôn */
        }

        /* Th√™m m·ªôt ch√∫t hi·ªáu ·ª©ng ƒë·ªï b√≥ng cho ti√™u ƒë·ªÅ ƒë·ªÉ b·∫Øt m·∫Øt h∆°n */
        .header-title {
            background: linear-gradient(to right, #1e293b, #ff8c00);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }
    </style>
</head>

<body class="flex min-h-screen">
    <aside
        class="w-80 sidebar-vibrant m-4 rounded-[3rem] shadow-2xl flex flex-col p-6 h-[calc(100vh-2rem)] sticky top-4">
        <div class="mb-8 px-4 mt-2">
            <h1 class="text-2xl font-black text-white tracking-tighter flex items-center gap-2">
                <span class="p-2 bg-white rounded-xl text-orange-400 text-lg shadow-sm">L</span>
                LIB<span class="text-slate-900">MODERN</span>
            </h1>
        </div>

        <div class="bg-white/10 rounded-[2rem] p-5 mb-6 backdrop-blur-sm border border-white/20 text-center">
            <div
                class="w-14 h-14 bg-white rounded-2xl mx-auto mb-3 flex items-center justify-center text-2xl shadow-md">
                üë§
            </div>
            <h3 class="text-white font-bold text-sm" id="user-display-name">
                ƒê·ªôc gi·∫£
            </h3>
            <p class="text-white/60 text-[10px] font-black uppercase mt-1">
                Th√†nh vi√™n
            </p>
        </div>

        <nav id="sidebarMenu" class="flex-1 overflow-y-auto no-scrollbar px-1">
            <div onclick="loadUserModule('dashboard', this)" class="nav-item active">
                <span>üè†</span> B·∫£ng ƒëi·ªÅu khi·ªÉn
            </div>
            <div onclick="loadUserModule('catalog', this)" class="nav-item">
                <span>üìö</span> Danh m·ª•c s√°ch
            </div>
            <div onclick="loadUserModule('cart', this)"
                class="nav-item flex items-center justify-between px-8 py-5 cursor-pointer rounded-[2rem] transition-all duration-500 font-bold text-slate-500 hover:bg-white">
                <div class="flex items-center gap-4">
                    <span>üõí</span> Gi·ªè h√†ng c·ªßa t√¥i
                </div>
                <span id="cartBadge"
                    class="cart-count w-6 h-6 bg-orange-500 text-white text-[10px] rounded-full flex items-center justify-center hidden shadow-lg shadow-orange-200">0</span>
            </div>
            <!-- <div onclick="loadUserModule('tickets', this)" class="nav-item">
                <span>üé´</span> Phi·∫øu m∆∞·ª£n
            </div> -->
            <div onclick="loadUserModule('history', this)" class="nav-item">
                <span>üìú</span> L·ªãch s·ª≠ m∆∞·ª£n
            </div>
            <div onclick="loadUserModule('settings', this)" class="nav-item">
                <span>‚öôÔ∏è</span> C√†i ƒë·∫∑t
            </div>
        </nav>

        <a href="index.html"
            class="mt-4 flex items-center justify-center gap-2 bg-slate-900 text-white p-4 rounded-2xl font-black text-xs hover:bg-red-500 transition-all shadow-lg uppercase tracking-widest">
            ƒêƒÉng xu·∫•t üö™
        </a>
    </aside>

    <main class="flex-1 p-10 main-vibrant-bg overflow-y-auto no-scrollbar">
        <header class="flex justify-between items-center mb-12">
            <div>
                <h2 id="moduleTitle" class="text-4xl font-black header-title tracking-tight">
                    Xin ch√†o üëã
                </h2>
                <p class="text-slate-400 font-medium mt-1">
                    Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi th∆∞ vi·ªán s·ªë.
                </p>
            </div>

            <div class="flex items-center gap-4">
                <button
                    class="w-14 h-14 bg-white rounded-2xl border border-slate-100 shadow-sm flex items-center justify-center text-xl hover:scale-105 transition-transform">
                    üîî
                </button>
            </div>
        </header>

        <div id="mainContent" class="animate-in fade-in duration-500"></div>
    </main>

    <script src="./js/user-controller/user-router.js"></script>
    <script src="./js/user-controller/dashboard.js"></script>
    <script src="./js/user-controller/catalog.js"></script>
    <script src="./js/user-controller/cart.js"></script>
    <script src="./js/user-controller/loan-tickets.js"></script>
    <script src="./js/user-controller/history.js"></script>
    <script src="./js/admin-controller/settings.js"></script>

    <script>
        // Kh·ªüi t·∫°o trang khi load
        window.onload = () => {
            loadUserModule('dashboard', document.querySelector('.nav-item.active'));
            updateCartBadge(); // C·∫≠p nh·∫≠t s·ªë l∆∞·ª£ng gi·ªè h√†ng ngay khi m·ªü trang
            setTimeout(() => {
                updateCartBadge();
            }, 100);

            // K√≠ch ho·∫°t ƒë·ªìng b·ªô th·ªùi gian th·ª±c
            if (typeof setupRealtimeSync === 'function') {
                setupRealtimeSync((newData) => {
                    // Reload module hi·ªán t·∫°i
                    if (window.currentUserModule) {
                        const activeNav = document.querySelector('.nav-item.active');
                        loadUserModule(window.currentUserModule, activeNav);
                    } else {
                        // M·∫∑c ƒë·ªãnh reload dashboard n·∫øu ch∆∞a c√≥ module n√†o
                        loadUserModule('dashboard', document.querySelector('.nav-item.active'));
                    }

                    // C·∫≠p nh·∫≠t badge gi·ªè h√†ng
                    if (typeof updateCartBadge === 'function') {
                        updateCartBadge();
                    }

                    // Ki·ªÉm tra v√† x√≥a s√°ch ƒë√£ m∆∞·ª£n kh·ªèi gi·ªè
                    if (typeof checkAndClearCart === 'function') {
                        checkAndClearCart(newData);
                    }
                });
            }
        };
    </script>
</body>

</html>